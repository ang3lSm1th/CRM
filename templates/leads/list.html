{% extends "base.html" %}
{% block title %}Leads{% endblock %}

{% block content %}
<div class="flex between">
  <h2>GestiÃ³n de Leads</h2>
  <a class="btn" href="{{ url_for('leads.create_lead') }}">âž• Nuevo Lead</a>
</div>

<link rel="stylesheet" href="{{ url_for('static', filename='css/buscador.css') }}">

<form method="GET"
      action="{{ url_for('leads.list_leads') }}"
      class="mb-3 d-flex buscador">

  <div class="search-wrap">
    <span class="search-icon">ðŸ”Ž</span>
    <input
      type="text"
      name="q"
      class="form-control search-input"
      placeholder="Buscar por cualquier campo (cÃ³digo, nombre, contacto, canal, etc.)"
      value="{{ q or '' }}">
  </div>

  <input type="date" name="f_ini" class="form-control date-input" value="{{ f_ini or '' }}">
  <input type="date" name="f_fin" class="form-control date-input" value="{{ f_fin or '' }}">

  <button type="submit" class="btn btn-primary btn-search">Buscar</button>

  {% if q or f_ini or f_fin %}
    <a class="btn btn-outline-secondary btn-clear" href="{{ url_for('leads.list_leads') }}">Limpiar</a>
  {% endif %}

  <button type="button" class="btn btn-success export-btn"
          data-table="#tabla-leads" data-filename="leads.xlsx">
    Exportar Excel
  </button>
</form>

{% if q or f_ini or f_fin %}
  <div class="mb-2 text-muted">
    Mostrando <strong>{{ total }}</strong> resultado{{ '' if total==1 else 's' }}
    {% if q %} para: <code>{{ q }}</code>{% endif %}
    {% if f_ini or f_fin %}
      {% if q %} | {% endif %}rango:
      <code>{{ f_ini or 'â€”' }}</code> â†’ <code>{{ f_fin or 'â€”' }}</code>
    {% endif %}
  </div>
{% endif %}

<div class="table-container">
  <table class="table" id="tabla-leads">
    <thead>
      <tr>
        <th>CÃ³digo</th><th>Fecha</th><th>TelÃ©fono</th><th>RUC/DNI</th>
        <th>Nombre</th><th>Canal</th><th>Contacto</th><th>DirecciÃ³n</th>
        <th>Departamento</th><th>Provincia</th><th>Distrito</th>
        <th>Bien/Servicio</th><th>Email</th><th>Comentario</th><th>Asignado a</th>
      </tr>
    </thead>
    <tbody>
      {% for l in leads %}
      <tr ondblclick="editarLead('{{ l.codigo }}')" class="row-clickable">
        <td>{{ l.codigo }}</td><td>{{ l.fecha }}</td><td>{{ l.telefono }}</td><td>{{ l.ruc_dni }}</td>
        <td>{{ l.nombre }}</td><td>{{ l.canal }}</td><td>{{ l.contacto }}</td><td>{{ l.direccion }}</td>
        <td>{{ l.departamento }}</td><td>{{ l.provincia }}</td><td>{{ l.distrito }}</td>
        <td>{{ l.bien_servicio }}</td><td>{{ l.email }}</td><td>{{ l.comentario }}</td><td>{{ l.asignado_a }}</td>
      </tr>
      {% else %}
      <tr><td colspan="15" class="no-data">No hay leads registrados.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>function editarLead(codigo){ location.href = "/leads/edit/" + codigo; }</script>
{% endblock %}
